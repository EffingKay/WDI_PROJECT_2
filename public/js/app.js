"use strict";function initMap(){function e(e,o,n){o.setPosition(n),o.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}map=new google.maps.Map(document.getElementById("map-canvas"),{center:new google.maps.LatLng(51.519132,(-.094205)),zoom:11});var o=new google.maps.InfoWindow({map:map});navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o={lat:e.coords.latitude,lng:e.coords.longitude};map.setCenter(o)},function(){e(!0,o,map.getCenter())}):e(!1,o,map.getCenter()),showPrisons()}function showPrisons(){var e={location:map.getCenter(),radius:"50000",query:"prison"};service=new google.maps.places.PlacesService(map),service.textSearch(e,searchForPrison)}function searchForPrison(e,o){if(o===google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<e.length;n++){var t=e[n];createMarkerPrison(t)}}function createMarkerPrison(e){new google.maps.Marker({position:e.geometry.location,map:map,animation:google.maps.Animation.DROP})}function init(){$(".registration").on("click",registerForm),$(".login").on("click",loginForm),$(".logout").on("click",logOut),$("body").on("submit","form",submittedForm),getToken()?loggedInState():loggedOutState(),initMap()}function registerForm(e){e.preventDefault(),$(".main").html('\n    <h4>Registration form</h4>\n    <div class="row">\n      <form  method="post" action="/register" class="col s12">\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="user_name" type="text" class="validate" name="user[username]">\n          <label for="user_name">Username</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="email" type="email" class="validate" name="user[email]">\n          <label for="email">Email</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password" type="password" class="validate" name="user[password]">\n          <label for="password">Password</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password-confirm" type="password" class="validate" name="user[passwordConfirmation]">\n          <label for="password-confirm">Confirm password</label>\n          </div>\n        </div>\n        <button class="btn waves-effect waves-light" type="submit" name="action">Register</button>\n      </form>\n    </div>')}function loginForm(e){e&&e.preventDefault(),$(".main").html('\n    <h4>Log in</h4>\n    <div class="row">\n      <form method="post" action="/login" class="col s12">\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="email" type="email" class="validate" name="email">\n          <label for="email">Email</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password" type="password" class="validate" name="password">\n          <label for="password">Password</label>\n          </div>\n        </div>\n        <button class="btn waves-effect waves-light" type="submit" name="action">Log in</button>\n      </form>\n    </div>')}function submittedForm(e){e&&e.preventDefault(),$.ajax({url:""+apiUrl+$(this).attr("action"),method:$(this).attr("method"),data:$(this).serialize(),beforeSend:setRequestHeader}).done(function(e){e.token&&setToken(e.token),loggedInState()}),$(".main").hide()}function setToken(e){return window.localStorage.setItem("token",e)}function setRequestHeader(e){return e.setRequestHeader("Authorization","Bearer "+getToken())}function getToken(){return window.localStorage.getItem("token")}function removeToken(){return window.localStorage.clear()}function loggedInState(){$(".loggedIn").show(),$(".loggedOut").hide()}function loggedOutState(){$(".loggedIn").hide(),$(".loggedOut").show()}function logOut(e){e.preventDefault(),loggedOutState(),loginForm(),removeToken()}var map=void 0,service=void 0,google=google,apiUrl="http://localhost:3000/api";$(init);