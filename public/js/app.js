"use strict";function initMap(){function e(){window.setTimeout(function(){showPrisons()},200)}map=new google.maps.Map(document.getElementById("map-canvas"),{center:new google.maps.LatLng(51.519132,(-.094205)),zoom:9,styles:[{stylers:[{visibility:"on"},{saturation:-100},{gamma:.54}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#4d4946"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{visibility:"simplified"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{gamma:.48}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{gamma:7.18}]}]}),showPrisons(),hideStations(),hideAirports(),newPrisonsListener=map.addListener("center_changed",e),$(".tabs").hide(),$(".main").hide(),$(".logo").on("click",initMap),$(".tabs").on("click",".showTrains",showTrains),$(".tabs").on("click",".hideTrains",hideStations),$(".tabs").on("click",".showAirports",showAirports),$(".tabs").on("click",".hideAirports",hideAirports),$(".journey").on("click",function(){journeyDetails(),$(".modal").modal()})}function showPrisons(){var e={location:map.getCenter(),radius:"50000",query:"prison"};service=new google.maps.places.PlacesService(map),service.textSearch(e,searchForPrison)}function searchForPrison(e,o){if(o===google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<e.length;n++){var i=e[n];createMarkerPrison(i,map)}}function createMarkerPrison(e,o){var n=new google.maps.Marker({position:e.geometry.location,map:o,icon:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-32.png"});prisonMarkers.push(n),n.addListener("click",function(){o.setCenter(n.getPosition())}),infoWindowPrison(e,n)}function infoWindowPrison(e,o){google.maps.event.addListener(o,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+e.name+"</h4>\n                <p>"+e.formatted_address+'</p>\n                <button class="myPrison waves-effect waves-teal btn-flat">Escape from here</button>'}),infoWindow.open(map,o),$("#map-canvas").on("click",".myPrison",function(){map.setZoom(15),infoWindow.close(),google.maps.event.removeListener(newPrisonsListener),prisonObject.address=e.formatted_address,getPrisonLatLng(prisonObject.address),$(".tabs").show(),clearMarkers(),createMarkerPrison(e,map),showPolice(e)})})}function getPrisonLatLng(e){prisonObject.addressFormatted=e.split(" ").join("+");var o="https://maps.googleapis.com/maps/api/geocode/json?address="+prisonObject.addressFormatted+"&key=AIzaSyDXaR7rUFJyMSNs2AIRsKRiwvNVTso_8lY";$.ajax(o).done(function(e){prisonObject.lat=e.results[0].geometry.location.lat,prisonObject.lng=e.results[0].geometry.location.lng})}function clearMarkers(){setMapOnAll(null)}function setMapOnAll(e){prisonMarkers.forEach(function(o){o.setMap(e)})}function showTrains(){var e={location:{lat:prisonObject.lat,lng:prisonObject.lng},radius:"50000",query:"rail station"};service=new google.maps.places.PlacesService(map),service.textSearch(e,searchForStations),map.setCenter(new google.maps.LatLng(prisonObject.lat,prisonObject.lng)),map.setZoom(12),$(".trains").addClass("hideTrains").removeClass("showTrains").html("hide trains")}function searchForStations(e,o){if(o===google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<e.length;n++){var i=e[n];createMarkerStation(i,map)}}function hideStations(){stationMarkers.forEach(function(e){e.setMap(null)}),$(".trains").removeClass("hideTrains").addClass("showTrains").html("show trains")}function createMarkerStation(e,o){var n=new google.maps.Marker({position:e.geometry.location,map:o,icon:"https://cdn3.iconfinder.com/data/icons/mapicons/icons/steamtrain.png"});infoWindowStation(e,n),stationMarkers.push(n)}function infoWindowStation(e,o){google.maps.event.addListener(o,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+e.name+'</h4>\n                <button class="destination waves-effect waves-teal btn-flat">get here</button>'}),infoWindow.open(map,o),$(".destination").on("click",function(){destination.location=o.getPosition(),destination.lat=o.getPosition().lat(),destination.lng=o.getPosition().lng(),journeyPlanner(destination.location)})})}function showAirports(){var e="https://api.sandbox.amadeus.com/v1.2/airports/nearest-relevant?apikey=yGCL11tesreUoG0MGKkjSYqMsAMwEju3&latitude="+prisonObject.lat+"&longitude="+prisonObject.lng;$.ajax(e).done(function(e){e.forEach(function(e){console.log(e),createMarkerAirport(e,map),map.setZoom(9)})}),$(".airports").addClass("hideAirports").removeClass("showAirports").html("hide airports")}function createMarkerAirport(e,o){var n={lat:e.location.latitude,lng:e.location.longitude},i=new google.maps.Marker({position:n,map:o,icon:"https://cdn4.iconfinder.com/data/icons/aiga-symbol-signs/612/aiga_air_transportation_bg-32.png"});infoWindowAirport(e,i),airportMarkers.push(i)}function infoWindowAirport(e,o){google.maps.event.addListener(o,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+e.airport_name+"</h4>\n                <h6>Aircraft movements: "+e.aircraft_movements+'</h6>\n                <button id="'+e.airport_name+'" class="destination waves-effect waves-teal btn-flat">get here</button>'}),infoWindow.open(map,o),$(".destination").on("click",function(){destination.location="",destination.location=o.getPosition(),destination.lat=o.getPosition().lat(),destination.lng=o.getPosition().lng(),journeyPlanner(destination.location)})})}function hideAirports(){airportMarkers.forEach(function(e){e.setMap(null)}),$(".airports").removeClass("hideAirports").addClass("showAirports").html("show airports")}function showPolice(e){var o={location:e.geometry.location,radius:"50000",query:"police"};service=new google.maps.places.PlacesService(map),service.textSearch(o,searchForPolice)}function searchForPolice(e,o){if(o===google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<e.length;n++){var i=e[n];createMarkerPolice(i,map)}}function createMarkerPolice(e,o){new google.maps.Marker({position:e.geometry.location,map:o,icon:"https://cdn1.iconfinder.com/data/icons/windows8_icons_iconpharm/26/police.png"})}function journeyPlanner(e){function o(o,n){o.route({origin:prisonObject.lat+","+prisonObject.lng,destination:e,travelMode:"DRIVING"},function(e,o){"OK"===o?n.setDirections(e):window.alert("Directions request failed due to "+o)})}null!==directionsDisplay&&(directionsDisplay.setMap(null),directionsDisplay=null),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0}),directionsDisplay.setMap(map),o(directionsService,directionsDisplay),infoWindow.close(),journeyDetails()}function journeyDetails(){function e(e,n){n!==google.maps.DistanceMatrixStatus.OK||"OK"!==n?console.log("Error:",n):(console.log(e.rows[0].elements[0].distance.text),console.log(e),$(".tabs").on("click",".journey",function(){return o(e)}))}function o(e){$("#modalJourneyDetails").html("\n      <p>Distance: "+e.rows[0].elements[0].distance.text+"</p>\n      <p>Duration in traffic: "+e.rows[0].elements[0].duration.text+"</p>\n    ")}service=new google.maps.DistanceMatrixService,service.getDistanceMatrix({origins:[{lat:prisonObject.lat,lng:prisonObject.lng}],destinations:[{lat:destination.lat,lng:destination.lng}],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC,durationInTraffic:!0,avoidHighways:!1,avoidTolls:!1},e)}var map=void 0,service=void 0,infoWindow=void 0,prisonMarkers=[],stationMarkers=[],airportMarkers=[],policeMarkers=[],newPrisonsListener=void 0,prisonObject={},destination={},google=google,directionsService=void 0,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0});$(initMap);