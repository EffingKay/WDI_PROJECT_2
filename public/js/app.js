"use strict";function initMap(){function o(){window.setTimeout(function(){showPrisons()},200)}map=new google.maps.Map(document.getElementById("map-canvas"),{center:new google.maps.LatLng(51.519132,(-.094205)),zoom:9}),showPrisons(),hideStations(),hideAirports(),newPrisonsListener=map.addListener("center_changed",o),$(".tabs").hide(),$(".brand-logo").on("click",initMap),$(".tabs").on("click",".showTrains",showTrains),$(".tabs").on("click",".hideTrains",hideStations),$(".tabs").on("click",".showAirports",showAirports),$(".tabs").on("click",".hideAirports",hideAirports)}function showPrisons(){var o={location:map.getCenter(),radius:"50000",query:"prison"};service=new google.maps.places.PlacesService(map),service.textSearch(o,searchForPrison)}function searchForPrison(o,n){if(n===google.maps.places.PlacesServiceStatus.OK)for(var e=0;e<o.length;e++){var i=o[e];createMarkerPrison(i,map)}}function createMarkerPrison(o,n){var e=new google.maps.Marker({position:o.geometry.location,map:n,icon:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-32.png"});prisonMarkers.push(e),e.addListener("click",function(){n.setCenter(e.getPosition())}),infoWindowPrison(o,e)}function infoWindowPrison(o,n){google.maps.event.addListener(n,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+o.name+"</h4>\n                <p>"+o.formatted_address+'</p>\n                <button class="myPrison waves-effect waves-teal btn-flat">Escape from here</button>'}),infoWindow.open(map,n),$("#map-canvas").on("click",".myPrison",function(){map.setZoom(15),infoWindow.close(),google.maps.event.removeListener(newPrisonsListener),prisonObject.address=o.formatted_address,getPrisonLatLng(prisonObject.address),$(".tabs").show(),clearMarkers(),createMarkerPrison(o,map),showPolice(o)})})}function getPrisonLatLng(o){prisonObject.addressFormatted=o.split(" ").join("+");var n="https://maps.googleapis.com/maps/api/geocode/json?address="+prisonObject.addressFormatted+"&key=AIzaSyDXaR7rUFJyMSNs2AIRsKRiwvNVTso_8lY";$.ajax(n).done(function(o){prisonObject.lat=o.results[0].geometry.location.lat,prisonObject.lng=o.results[0].geometry.location.lng})}function clearMarkers(){setMapOnAll(null)}function setMapOnAll(o){prisonMarkers.forEach(function(n){n.setMap(o),prisonMarkers=[]})}function showTrains(){var o={location:{lat:prisonObject.lat,lng:prisonObject.lng},radius:"50000",query:"rail station"};service=new google.maps.places.PlacesService(map),service.textSearch(o,searchForStations),map.setCenter(new google.maps.LatLng(prisonObject.lat,prisonObject.lng)),map.setZoom(12),$(".trains").addClass("hideTrains").removeClass("showTrains").html("hide trains")}function searchForStations(o,n){if(n===google.maps.places.PlacesServiceStatus.OK)for(var e=0;e<o.length;e++){var i=o[e];createMarkerStation(i,map)}}function hideStations(){stationMarkers.forEach(function(o){o.setMap(null)}),$(".trains").removeClass("hideTrains").addClass("showTrains").html("show trains")}function createMarkerStation(o,n){var e=new google.maps.Marker({position:o.geometry.location,map:n,icon:"https://cdn3.iconfinder.com/data/icons/mapicons/icons/steamtrain.png"});infoWindowStation(o,e),stationMarkers.push(e)}function infoWindowStation(o,n){google.maps.event.addListener(n,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+o.name+'</h4>\n                <button class="destination waves-effect waves-teal btn-flat">get here</button>'}),infoWindow.open(map,n),$(".destination").on("click",function(){destination.location=n.getPosition(),journeyPlanner(destination.location)})})}function showAirports(){var o="https://api.sandbox.amadeus.com/v1.2/airports/nearest-relevant?apikey=yGCL11tesreUoG0MGKkjSYqMsAMwEju3&latitude="+prisonObject.lat+"&longitude="+prisonObject.lng;$.ajax(o).done(function(o){o.forEach(function(o){console.log(o),createMarkerAirport(o,map),map.setZoom(9)})}),$(".airports").addClass("hideAirports").removeClass("showAirports").html("hide airports")}function createMarkerAirport(o,n){var e={lat:o.location.latitude,lng:o.location.longitude},i=new google.maps.Marker({position:e,map:n,icon:"https://cdn4.iconfinder.com/data/icons/aiga-symbol-signs/612/aiga_air_transportation_bg-32.png"});infoWindowAirport(o,i),airportMarkers.push(i)}function infoWindowAirport(o,n){google.maps.event.addListener(n,"click",function(){"undefined"!=typeof infoWindow&&infoWindow.close(),infoWindow=new google.maps.InfoWindow({content:"<h4>"+o.airport_name+"</h4>\n                <h6>Distance: "+o.distance+" km</h6>\n                <h6>Aircraft movements: "+o.aircraft_movements+'</h6>\n                <button id="'+o.airport_name+'" class="destination waves-effect waves-teal btn-flat">get here</button>'}),infoWindow.open(map,n),$(".destination").on("click",function(){destination.location="",destination.location=n.getPosition(),journeyPlanner(destination.location)})})}function hideAirports(){airportMarkers.forEach(function(o){o.setMap(null)}),$(".airports").removeClass("hideAirports").addClass("showAirports").html("show airports")}function showPolice(o){var n={location:o.geometry.location,radius:"50000",query:"police"};service=new google.maps.places.PlacesService(map),service.textSearch(n,searchForPolice)}function searchForPolice(o,n){if(n===google.maps.places.PlacesServiceStatus.OK)for(var e=0;e<o.length;e++){var i=o[e];createMarkerPolice(i,map)}}function createMarkerPolice(o,n){new google.maps.Marker({position:o.geometry.location,map:n,icon:"https://cdn1.iconfinder.com/data/icons/windows8_icons_iconpharm/26/police.png"})}function journeyPlanner(o){function n(n,e){n.route({origin:prisonObject.lat+","+prisonObject.lng,destination:o,travelMode:"DRIVING"},function(o,n){"OK"===n?e.setDirections(o):window.alert("Directions request failed due to "+n)})}null!==directionsDisplay&&(directionsDisplay.setMap(null),directionsDisplay=null),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0}),directionsDisplay.setMap(map),n(directionsService,directionsDisplay),infoWindow.close()}var map=void 0,service=void 0,infoWindow=void 0,prisonMarkers=[],stationMarkers=[],airportMarkers=[],newPrisonsListener=void 0,prisonObject={},destination={},google=google,directionsService=void 0,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0});$(initMap);