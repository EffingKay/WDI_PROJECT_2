"use strict";function init(){$(".registration").on("click",registerForm),$(".login").on("click",loginForm),$(".logout").on("click",logOut),$("body").on("submit","form",submittedForm),$(".users").on("click",usersIndex),$("body").on("click",".backToMap",closeForms),$(".button-collapse").sideNav({menuWidth:500,edge:"right",closeOnClick:!0,draggable:!0}),getToken()?loggedInState():loggedOutState()}function registerForm(e){e.preventDefault(),$("#map-canvas").hide(),$(".tabs").hide(),$(".main").show().html('\n    <h4>Registration form</h4>\n    <div class="row">\n      <form  method="post" action="/register" class="col s12">\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="user_name" type="text" class="validate" name="user[username]">\n          <label for="user_name">Username (we recommend not to use your real name)</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="email" type="email" class="validate" name="user[email]">\n          <label for="email">Email</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password" type="password" class="validate" name="user[password]">\n          <label for="password">Password</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password-confirm" type="password" class="validate" name="user[passwordConfirmation]">\n          <label for="password-confirm">Confirm password</label>\n          </div>\n        </div>\n        <button class="btn waves-effect waves-light" type="submit" name="action">Register</button>\n        <a class="backToMap waves-effect waves-teal btn-flat">Close</a>\n      </form>\n    </div>')}function loginForm(e){e&&e.preventDefault(),$("#map-canvas").hide(),$(".tabs").hide(),$(".main").show().html('\n    <h4>Log in</h4>\n    <div class="row">\n      <form method="post" action="/login" class="col s12">\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="email" type="email" class="validate" name="email">\n          <label for="email">Email</label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-field col s12">\n          <input id="password" type="password" class="validate" name="password">\n          <label for="password">Password</label>\n          </div>\n        </div>\n        <button class="btn waves-effect waves-light" type="submit" name="action">Log in</button>\n        <a class="backToMap waves-effect waves-teal btn-flat">Close</a>\n      </form>\n    </div>')}function submittedForm(e){e&&e.preventDefault(),$.ajax({url:""+apiUrl+$(this).attr("action"),method:$(this).attr("method"),data:$(this).serialize(),beforeSend:setRequestHeader}).done(function(e){e.token&&setToken(e.token),loggedInState(),setUser(e.user.username,e.user.email)}),$(".main").hide(),$("#map-canvas").show()}function setUser(e,a){window.localStorage.setItem("username",e),window.localStorage.setItem("email",a)}function setToken(e){return window.localStorage.setItem("token",e)}function setRequestHeader(e){return e.setRequestHeader("Authorization","Bearer "+getToken())}function getToken(){return window.localStorage.getItem("token")}function removeToken(){return window.localStorage.clear()}function loggedInState(){$(".loggedIn").show(),$(".loggedOut").hide()}function loggedOutState(){$(".loggedIn").hide(),$(".loggedOut").show()}function logOut(e){e.preventDefault(),loggedOutState(),loginForm(),removeToken(),$(".tab").hide()}function closeForms(){$(".main").hide(),$("#map-canvas").show()}function getUsername(){return window.localStorage.getItem("username")}function getEmail(){return window.localStorage.getItem("email")}function usersIndex(e){e&&e.preventDefault();var a=getUsername(),n=getEmail(),s=apiUrl+"/users";return $.ajax({url:s,method:"GET",beforeSend:setRequestHeader}).done(function(e){$(".main").hide(),$(".userList").html("").append('\n      <li><div class="userView">\n        <div class="background">\n          <img src="/images/side-bg.jpg">\n        </div>\n        <img class="circle" src="https://cdn3.iconfinder.com/data/icons/ballicons-free/128/wooman.png">\n        <a href="#!name"><span id="usernameSlide" class="black-text name">'+a+'</span></a>\n        <a href="#!email"><span id="emailSlide" class="black-text email">'+n+'</span></a>\n      </div></li>\n      <li><a class="subheader">My profile</a></li>\n      <li><a href="#!">Edit</a></li>\n      <li><div class="divider"></div></li>\n      <li><a class="subheader">Other escapees</a></li>\n      '),$.each(e.users,function(e,a){$(".userList").append('\n        <li><a class="waves-effect" href="#!">'+a.username+"</a></li>\n      ")})})}var apiUrl="http://localhost:3000/api";$(init);