"use strict";function init(){$(".registration").on("click",registerForm),$(".login").on("click",loginForm),$(".logout").on("click",logOut),$("body").on("submit","form",submittedForm),$(".users").on("click",usersIndex),$("body").on("click",".backToMap",closeForms),$(".button-collapse").sideNav({menuWidth:500,edge:"right",closeOnClick:!0,draggable:!0}),getToken()?loggedInState():loggedOutState()}function registerForm(e){e.preventDefault(),$(".tabs").hide(),$("#registrationModal").modal()}function loginForm(e){e&&e.preventDefault(),$(".tabs").hide(),$("#loginModal").modal()}function submittedForm(e){e&&e.preventDefault(),$.ajax({url:""+apiUrl+$(this).attr("action"),method:$(this).attr("method"),data:$(this).serialize(),beforeSend:setRequestHeader}).done(function(e){e.token&&setToken(e.token),loggedInState(),setUser(e.user.username,e.user.email)}),$(".main").hide(),$("#map-canvas").show(),$(".modal").modal("close")}function setUser(e,t){window.localStorage.setItem("username",e),window.localStorage.setItem("email",t)}function setToken(e){return window.localStorage.setItem("token",e)}function setRequestHeader(e){return e.setRequestHeader("Authorization","Bearer "+getToken())}function getToken(){return window.localStorage.getItem("token")}function removeToken(){return window.localStorage.clear()}function loggedInState(){$(".loggedIn").show(),$(".loggedOut").hide()}function loggedOutState(){$(".loggedIn").hide(),$(".loggedOut").show()}function logOut(e){e.preventDefault(),loggedOutState(),loginForm(),removeToken(),$(".tab").hide(),$(".button-collapse").sideNav("hide")}function closeForms(){$(".modal").modal("close")}function getUsername(){return window.localStorage.getItem("username")}function getEmail(){return window.localStorage.getItem("email")}function usersIndex(e){e&&e.preventDefault();var t=getUsername(),n=getEmail(),o=apiUrl+"/users";return $.ajax({url:o,method:"GET",beforeSend:setRequestHeader}).done(function(e){$(".main").hide(),$(".userList").html("").append('\n      <li><div class="userView">\n        <div class="background">\n          <img src="/images/blackwhitecity.jpg">\n        </div>\n        <img class="circle" src="https://cdn3.iconfinder.com/data/icons/ballicons-free/128/wooman.png">\n        <a href="#!name"><span id="usernameSlide" class="white-text name">'+t+'</span></a>\n        <a href="#!email"><span id="emailSlide" class="white-text email">'+n+'</span></a>\n      </div></li>\n      <li><a class="subheader">My profile</a></li>\n      <li><a href="#!">Edit</a></li>\n      <li><div class="divider"></div></li>\n      <li><a class="subheader">Other escapees</a></li>\n      '),$.each(e.users,function(e,t){$(".userList").append('\n        <li><a class="waves-effect" href="#!">'+t.username+"</a></li>\n      ")})})}var apiUrl="http://localhost:3000/api";$(init);